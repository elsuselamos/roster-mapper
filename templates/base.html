<!DOCTYPE html>
<html lang="vi" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ page_title | default('Roster Mapper') }}{% endblock %} - Vietjet AMO</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="/static/favicon.ico">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'vj-red': '#E31837',
                        'vj-red-dark': '#B71530',
                        'vj-yellow': '#FFD700',
                    }
                }
            }
        }
    </script>
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        [x-cloak] { display: none !important; }
        .htmx-request .htmx-indicator { display: inline-block; }
        .htmx-indicator { display: none; }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #999; }
        
        /* Mapped cell highlight */
        .cell-mapped { background-color: #d1fae5 !important; }
        .cell-unmapped { background-color: #fee2e2 !important; }
        
        /* Loading Spinner */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
        }
        .loading-overlay.active {
            display: flex;
        }
        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #E31837;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-text {
            margin-top: 20px;
            font-size: 16px;
            color: #666;
            font-weight: 500;
        }
        .loading-subtext {
            margin-top: 8px;
            font-size: 14px;
            color: #999;
        }
        
        /* Button loading state */
        .btn-loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }
        .btn-loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-left: -10px;
            margin-top: -10px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
    </style>
    
    {% block head %}{% endblock %}
</head>
<body class="h-full bg-gray-50">
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text" id="loading-text">ƒêang x·ª≠ l√Ω...</div>
        <div class="loading-subtext" id="loading-subtext">Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t</div>
    </div>
    
    <div class="min-h-full">
        <!-- Navigation -->
        <nav class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <!-- Logo -->
                    <div class="flex items-center">
                        <a href="/" class="flex items-center space-x-3">
                            <span class="text-2xl">üõ´</span>
                            <div>
                                <h1 class="text-xl font-bold">
                                    <span class="text-vj-red">ROSTER</span>
                                    <span class="text-gray-800">MAPPER</span>
                                </h1>
                                <p class="text-xs text-gray-500">Vietjet AMO</p>
                            </div>
                        </a>
                    </div>
                    
                    <!-- Navigation Links -->
                    <div class="flex items-center space-x-1">
                        <a href="/upload" 
                           class="px-4 py-2 rounded-lg text-sm font-medium transition-colors
                                  {% if request.url.path == '/upload' %}bg-vj-red text-white{% else %}text-gray-600 hover:bg-gray-100{% endif %}">
                            üì§ Upload
                        </a>
                        <a href="/admin" 
                           class="px-4 py-2 rounded-lg text-sm font-medium transition-colors
                                  {% if request.url.path == '/admin' %}bg-vj-red text-white{% else %}text-gray-600 hover:bg-gray-100{% endif %}">
                            ‚öôÔ∏è Admin
                        </a>
                        <a href="/dashboard" 
                           class="px-4 py-2 rounded-lg text-sm font-medium transition-colors
                                  {% if request.url.path == '/dashboard' %}bg-vj-red text-white{% else %}text-gray-600 hover:bg-gray-100{% endif %}">
                            üìä Dashboard
                        </a>
                        <a href="/docs" target="_blank"
                           class="px-4 py-2 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-100 transition-colors">
                            üìö API Docs
                        </a>
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            {% block content %}{% endblock %}
        </main>
        
        <!-- Footer -->
        <footer class="bg-white border-t border-gray-200 mt-auto">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <div class="flex justify-between items-center text-sm text-gray-500">
                    <p>¬© 2025 Vietjet AMO - IT Department</p>
                    <p>
                        <a href="https://www.vietjetair.com" target="_blank" class="text-vj-red hover:underline">
                            vietjetair.com
                        </a>
                    </p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Global Loading Script -->
    <script>
        // Loading overlay functions
        function showLoading(text = 'ƒêang x·ª≠ l√Ω...', subtext = 'Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t') {
            const overlay = document.getElementById('loading-overlay');
            const loadingText = document.getElementById('loading-text');
            const loadingSubtext = document.getElementById('loading-subtext');
            if (overlay) {
                loadingText.textContent = text;
                loadingSubtext.textContent = subtext;
                overlay.classList.add('active');
            }
        }
        
        function hideLoading() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.classList.remove('active');
            }
        }
        
        // Auto-attach to forms with data-loading attribute
        document.addEventListener('DOMContentLoaded', function() {
            // Handle forms with loading
            document.querySelectorAll('form[data-loading]').forEach(function(form) {
                form.addEventListener('submit', function(e) {
                    const text = form.dataset.loadingText || 'ƒêang x·ª≠ l√Ω...';
                    const subtext = form.dataset.loadingSubtext || 'Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t';
                    showLoading(text, subtext);
                    
                    // Disable submit button
                    const submitBtn = form.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.classList.add('btn-loading');
                        submitBtn.disabled = true;
                    }
                });
            });
            
            // Handle links with loading
            document.querySelectorAll('a[data-loading]').forEach(function(link) {
                link.addEventListener('click', function(e) {
                    const text = link.dataset.loadingText || 'ƒêang t·∫£i...';
                    const subtext = link.dataset.loadingSubtext || 'Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t';
                    showLoading(text, subtext);
                });
            });
        });
        
        // Hide loading on page show (for back button)
        window.addEventListener('pageshow', function(event) {
            hideLoading();
            document.querySelectorAll('.btn-loading').forEach(function(btn) {
                btn.classList.remove('btn-loading');
                btn.disabled = false;
            });
        });
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>
